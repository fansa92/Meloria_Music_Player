name: Build Flutter Windows Portable ZIP

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  build-windows:
    runs-on: windows-latest

    steps:
    - name: 📥 Checkout code
      uses: actions/checkout@v4

    - name: Setup Flutter
      uses: subosito/flutter-action@v2
      with:
        channel: stable
        flutter-version: '3.20.0'

    - name: flutter --version
      run: flutter --version

    - name: Enable Windows desktop support
      run: flutter config --enable-windows-desktop

    - name: Install dependencies
      run: flutter pub get

    - name: 🏗️ Build portable .exe
      run: flutter build windows --release --portable

    - name: 📁 Prepare portable package
      run: |
        cd build/windows/runner/Release
        mkdir portable-app
        copy *.dll portable-app/
        copy *.exe portable-app/
        mkdir portable-app\data
        xcopy /E /I ../../../../data portable-app\data

    - name: 🧩 Zip portable package
      run: |
        cd build/windows/runner/Release
        powershell -Command "Compress-Archive -Path portable-app\* -DestinationPath portable-app.zip"

    - name: 📦 Upload ZIP artifact
      uses: actions/upload-artifact@v4
      with:
        name: flutter-windows-portable
        path: build/windows/runner/Release/portable-app.zip
