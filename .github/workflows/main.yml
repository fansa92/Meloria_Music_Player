name: Build Flutter Windows Portable ZIP

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  build-windows:
    runs-on: windows-latest

    steps:
    - name: ğŸ“¥ Checkout code
      uses: actions/checkout@v4

    - name: Set up Flutter
      uses: subosito/flutter-action@v2
      with:
        flutter-version: '3.22.0'
        
    - name: Get dependencies
      run: flutter pub get

    - name: Build Windows
      run: flutter build windows


    - name: ğŸ“ Prepare portable package
      run: |
        cd build/windows/runner/Release
        mkdir portable-app
        copy *.dll portable-app/
        copy *.exe portable-app/
        mkdir portable-app\data
        xcopy /E /I ../../../../data portable-app\data

    - name: ğŸ§© Zip portable package
      run: |
        cd build/windows/runner/Release
        powershell -Command "Compress-Archive -Path portable-app\* -DestinationPath portable-app.zip"

    - name: ğŸ“¦ Upload ZIP artifact
      uses: actions/upload-artifact@v4
      with:
        name: flutter-windows-portable
        path: build\windows\x64\runner\Release\*
